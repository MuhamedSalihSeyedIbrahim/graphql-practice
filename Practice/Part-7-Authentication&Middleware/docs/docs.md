<h1>Authentication and Express Middleware</h1><div><p>It&apos;s simple to use any Express middleware in conjunction with <code>express-graphql</code>. In particular, this is a great pattern for handling authentication.</p><p>To use middleware with a GraphQL resolver, just use the middleware like you would with a normal Express app. The <code>request</code> object is then available as the second argument in any resolver.</p><p>For example, let&apos;s say we wanted our server to log the IP address of every request, and we also want to write an API that returns the IP address of the caller. We can do the former with middleware, and the latter by accessing the <code>request</code> object in a resolver. Here&apos;s server code that implements this:</p><pre class="prism language-javascript"><span class="keyword">var</span> express <span class="operator">=</span> <span class="function">require</span><span class="punctuation">(</span><span class="string">&apos;express&apos;</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">var</span> graphqlHTTP <span class="operator">=</span> <span class="function">require</span><span class="punctuation">(</span><span class="string">&apos;express-graphql&apos;</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="keyword">var</span> <span class="punctuation">{</span> buildSchema <span class="punctuation">}</span> <span class="operator">=</span> <span class="function">require</span><span class="punctuation">(</span><span class="string">&apos;graphql&apos;</span><span class="punctuation">)</span><span class="punctuation">;</span>

<span class="keyword">var</span> schema <span class="operator">=</span> <span class="function">buildSchema</span><span class="punctuation">(</span><span class="template-string"><span class="string">`type Query { ip: String }`</span></span><span class="punctuation">)</span><span class="punctuation">;</span>

<span class="keyword">const</span> loggingMiddleware <span class="operator">=</span> <span class="punctuation">(</span>req<span class="punctuation">,</span> res<span class="punctuation">,</span> next<span class="punctuation">)</span> <span class="operator">=</span><span class="operator">&gt;</span> <span class="punctuation">{</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span><span class="string">&apos;ip:&apos;</span><span class="punctuation">,</span> req<span class="punctuation">.</span>ip<span class="punctuation">)</span><span class="punctuation">;</span>
<span class="function">next</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
<span class="punctuation">}</span>

<span class="keyword">var</span> root <span class="operator">=</span> <span class="punctuation">{</span>
ip<span class="punctuation">:</span> <span class="keyword">function</span> <span class="punctuation">(</span>args<span class="punctuation">,</span> request<span class="punctuation">)</span> <span class="punctuation">{</span>
<span class="keyword">return</span> request<span class="punctuation">.</span>ip<span class="punctuation">;</span>
<span class="punctuation">}</span>
<span class="punctuation">}</span><span class="punctuation">;</span>

<span class="keyword">var</span> app <span class="operator">=</span> <span class="function">express</span><span class="punctuation">(</span><span class="punctuation">)</span><span class="punctuation">;</span>
app<span class="punctuation">.</span><span class="function">use</span><span class="punctuation">(</span>loggingMiddleware<span class="punctuation">)</span><span class="punctuation">;</span>
app<span class="punctuation">.</span><span class="function">use</span><span class="punctuation">(</span><span class="string">&apos;/graphql&apos;</span><span class="punctuation">,</span> <span class="function">graphqlHTTP</span><span class="punctuation">(</span><span class="punctuation">{</span>
schema<span class="punctuation">:</span> schema<span class="punctuation">,</span>
rootValue<span class="punctuation">:</span> root<span class="punctuation">,</span>
graphiql<span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span>
<span class="punctuation">}</span><span class="punctuation">)</span><span class="punctuation">)</span><span class="punctuation">;</span>
app<span class="punctuation">.</span><span class="function">listen</span><span class="punctuation">(</span><span class="number">4000</span><span class="punctuation">)</span><span class="punctuation">;</span>
console<span class="punctuation">.</span><span class="function">log</span><span class="punctuation">(</span><span class="string">&apos;Running a GraphQL API server at localhost:4000/graphql&apos;</span><span class="punctuation">)</span><span class="punctuation">;</span></pre><p>In a REST API, authentication is often handled with a header, that contains an auth token which proves what user is making this request. Express middleware processes these headers and puts authentication data on the Express <code>request</code> object. Some middleware modules that handle authentication like this are <a href="http://passportjs.org/" target="_blank" rel="nofollow noopener noreferrer">Passport</a>, <a href="https://github.com/auth0/express-jwt" target="_blank" rel="nofollow noopener noreferrer">express-jwt</a>, and <a href="https://github.com/expressjs/session" target="_blank" rel="nofollow noopener noreferrer">express-session</a>. Each of these modules works with <code>express-graphql</code>.</p><p>If you aren&apos;t familiar with any of these authentication mechanisms, we recommend using <code>express-jwt</code> because it&apos;s simple without sacrificing any future flexibility.</p><p>If you&apos;ve read through the docs linearly to get to this point, congratulations! You now know everything you need to build a practical GraphQL API server.</p></div>
